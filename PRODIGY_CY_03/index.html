<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Password Checker — Final UI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0f1724;--muted:#9aa4b2;--accent1:#7c3aed;--accent2:#06b6d4;--ok:#10b981;--danger:#ef4444}
*{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Arial}
body{margin:0;min-height:100vh;background:radial-gradient(900px 400px at 10% 10%, rgba(124,58,237,0.12), transparent),var(--bg); color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:28px;}
.wrap{max-width:980px;width:100%;display:grid;grid-template-columns:1fr 420px;gap:28px}
.card{background:rgba(255,255,255,0.02);padding:22px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.title{font-weight:800;font-size:22px;margin-bottom:8px}
input{width:100%;padding:12px 14px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);color:#fff;font-size:15px}
.row{display:flex;gap:8px;margin-top:10px}
.btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.mutebtn{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px}
.meter{margin-top:16px}
.track{height:16px;border-radius:999px;background:rgba(255,255,255,0.03);overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
.fill{height:100%;width:0%;transition:width 400ms, background 300ms}
.meta{display:flex;justify-content:space-between;margin-top:8px;align-items:center}
.label{font-weight:800}
.ttc{color:var(--muted);font-size:13px}
.small{font-size:13px;color:var(--muted)}
.suggest{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
.s-left{max-width:70%}
.s-right{display:flex;gap:8px;align-items:center}
.apply{background:#111827;border-radius:8px;padding:6px 10px;color:#fff;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
.copy{background:transparent;border-radius:8px;padding:6px 8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted)}
.mutedsmall{color:var(--muted);font-size:12px}
@media (max-width:920px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="title">NextGen Password Checker</div>
      <div class="small">Detects unknown-word patterns, simulates attackers, and suggests fixes.</div>

      <div style="margin-top:12px;">
        <input id="pw" placeholder="Type password or click generate" autocomplete="new-password"/>
        <div class="row" style="margin-top:10px;">
          <button id="generate" class="btn">Generate Secure Passphrase</button>
          <button id="copy" class="copy">Copy</button>
          <button id="show" class="mutebtn">Show</button>
        </div>

        <div class="meter">
          <div class="track" style="margin-top:12px;"><div id="fill" class="fill"></div></div>
          <div class="meta">
            <div class="label" id="label">—</div>
            <div class="ttc" id="ttc">time to crack — —</div>
          </div>
        </div>

        <div style="margin-top:14px;" class="card">
          <div style="font-weight:700;margin-bottom:8px">Actionable Tips</div>
          <ul id="reasons" style="margin:0;padding-left:18px;color:#e8f2ff"></ul>
        </div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px">
      <div class="card">
        <div style="font-weight:800">Suggested Fixes</div>
        <div style="margin-top:8px" id="sugs">
          <div class="mutedsmall">Type a password to see personalized suggestions.</div>
        </div>
        <div style="margin-top:8px" class="small mutedsmall">Each suggestion shows predicted score & time-to-crack if applied.</div>
      </div>

      <div class="card">
        <div style="font-weight:800">Quick Examples</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="mutebtn example">P@ssw0rd</button>
          <button class="mutebtn example">OrbitSilentRocket!</button>
          <button class="mutebtn example">abc12345</button>
        </div>
      </div>
    </div>
  </div>

<script>
const pwInput = document.getElementById('pw');
const fill = document.getElementById('fill');
const label = document.getElementById('label');
const ttcEl = document.getElementById('ttc');
const reasonsEl = document.getElementById('reasons');
const generateBtn = document.getElementById('generate');
const copyBtn = document.getElementById('copy');
const showBtn = document.getElementById('show');
const sugsDiv = document.getElementById('sugs');

let debounceTimer = 0;

function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

function clientQuickScore(pw){
  let score=0;
  if(pw.length>=8) score+=30;
  if(pw.length>=12) score+=15;
  if(/[a-z]/.test(pw)) score+=10;
  if(/[A-Z]/.test(pw)) score+=10;
  if(/\d/.test(pw)) score+=10;
  if(/[^A-Za-z0-9]/.test(pw)) score+=10;
  if(/(.)\1\1/.test(pw)) score-=15;
  if(/(password|1234|qwerty|abcd|letmein)/i.test(pw)) score = Math.min(score, 15);
  score = clamp(Math.round(score),0,100);
  return score;
}

function updateMeter(score){
  fill.style.width = score + '%';
  if(score > 80) fill.style.background = 'linear-gradient(90deg,#06b6d4,#10b981)';
  else if(score > 55) fill.style.background = 'linear-gradient(90deg,#f59e0b,#f97316)';
  else fill.style.background = 'linear-gradient(90deg,#ef4444,#f97316)';
  label.innerText = score < 30 ? 'Weak' : score < 55 ? 'Fair' : score < 75 ? 'Good' : score < 90 ? 'Strong' : 'Excellent';
}

function showReasons(list){
  reasonsEl.innerHTML = '';
  if(!list || list.length===0){
    reasonsEl.innerHTML = '<li>Type a password to get detailed feedback.</li>'; return;
  }
  list.forEach(r => { const li = document.createElement('li'); li.innerText = r; reasonsEl.appendChild(li); });
}

async function serverCheck(pw){
  if(!pw){ updateMeter(0); ttcEl.innerText='time to crack — —'; showReasons([]); sugsDiv.innerHTML='<div class="mutedsmall">Type a password to see personalized suggestions.</div>'; return; }
  try{
    const resp = await fetch('http://127.0.0.1:8000/check', {
      method:'POST', headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ password: pw, leaked: false })
    });
    if(!resp.ok) throw new Error('server error');
    const data = await resp.json();
    updateMeter(data.score);
    ttcEl.innerText = 'time to crack — ' + (data.ttc || '—');
    showReasons(data.reasons || []);
    renderSuggestions(data.suggestions || []);
  }catch(err){
    console.warn('server check failed', err);
    ttcEl.innerText = 'time to crack — unknown';
    showReasons(['Server check unavailable — using client estimate.']);
  }
}

function renderSuggestions(suggestions){
  sugsDiv.innerHTML = '';
  if(!suggestions || suggestions.length === 0){
    sugsDiv.innerHTML = '<div class="mutedsmall">No suggestions available.</div>'; return;
  }
  suggestions.forEach((s, idx) => {
    const wrap = document.createElement('div');
    wrap.className = 'suggest';
    const left = document.createElement('div'); left.className='s-left';
    left.innerHTML = `<div style="font-weight:700">${s.why}</div>
                      <div class="mutedsmall" style="margin-top:6px">example: <code>${escapeHtml(s.example)}</code></div>
                      <div class="mutedsmall" style="margin-top:6px">predicted score: <strong>${s.score}</strong> • time-to-crack: <strong>${s.ttc}</strong></div>`;
    const right = document.createElement('div'); right.className='s-right';
    const applyBtn = document.createElement('button'); applyBtn.className='apply'; applyBtn.innerText='Apply';
    applyBtn.onclick = () => {
      pwInput.value = s.example;
      pwInput.dispatchEvent(new Event('input'));
    };
    const copyBtn = document.createElement('button'); copyBtn.className='copy'; copyBtn.innerText='Copy';
    copyBtn.onclick = async () => { await navigator.clipboard.writeText(s.example); copyBtn.innerText='Copied'; setTimeout(()=>copyBtn.innerText='Copy',1200); };
    right.appendChild(applyBtn); right.appendChild(copyBtn);
    wrap.appendChild(left); wrap.appendChild(right);
    sugsDiv.appendChild(wrap);
  });
}

pwInput.addEventListener('input', (e)=>{
  const v = e.target.value;
  const preview = clientQuickScore(v);
  updateMeter(preview);
  ttcEl.innerText = 'time to crack — estimating...';
  showReasons([ v.length < 12 ? 'Consider using 12+ characters or a 3-word passphrase.' : 'Consider adding symbol / mix of cases for extra safety.' ]);

  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(()=>serverCheck(v), 420);
});

generateBtn.addEventListener('click', async ()=>{
  generateBtn.disabled=true; generateBtn.innerText='Generating...';
  try{
    const res = await fetch('http://127.0.0.1:8000/generate', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({words:3,capitalize:true,add_symbol:true})});
    const j = await res.json();
    pwInput.value = j.password; pwInput.dispatchEvent(new Event('input'));
  }catch(e){ alert('Generate failed — is the server running?'); }
  generateBtn.disabled=false; generateBtn.innerText='Generate Secure Passphrase';
});

copyBtn.addEventListener('click', async ()=>{
  const v = pwInput.value;
  if(!v){ copyBtn.innerText='Nothing'; setTimeout(()=>copyBtn.innerText='Copy',900); return; }
  try{ await navigator.clipboard.writeText(v); copyBtn.innerText='Copied ✓'; setTimeout(()=>copyBtn.innerText='Copy',1200); }catch(e){ copyBtn.innerText='Fail'; setTimeout(()=>copyBtn.innerText='Copy',1200); }
});

showBtn.addEventListener('click', ()=>{ if(pwInput.type==='password'){ pwInput.type='text'; showBtn.innerText='Hide'; } else { pwInput.type='password'; showBtn.innerText='Show'; } });

document.querySelectorAll('.example').forEach(btn=>{
  btn.addEventListener('click', (e)=>{ pwInput.value = e.target.innerText; pwInput.dispatchEvent(new Event('input')); pwInput.focus(); });
});

function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

updateMeter(0);
ttcEl.innerText='time to crack — —';
showReasons([]);
sugsDiv.innerHTML='<div class="mutedsmall">Type a password to see personalized suggestions.</div>';
</script>
</body>
</html>
